{% extends 'base.html' %}
{% block content %}
<div class="flex flex-col md:flex-row gap-6">
  <div class="md:w-2/3">
    <img src="{{ post.image_url }}" class="w-full rounded border object-cover"/>
    {% if post.caption %}
      <p class="mt-2 text-gray-700">{{ post.caption }}</p>
    {% endif %}
  </div>

  <div class="md:w-1/3">
    <!-- Author card + Message 버튼 -->
    <div class="border rounded p-3 mb-4">
      <div class="flex items-center gap-3">
        <img src="{{ author.avatar_url or '/static/avatar-placeholder.png' }}" class="w-12 h-12 rounded-full object-cover border">
        <div>
          <div class="font-semibold">{{ author.nickname or author.username }}</div>
          <div class="text-sm text-gray-500">{{ author.sport or '—' }}</div>
        </div>
      </div>
      {% if user and user.id != author.id %}
      <form method="post" action="/chat/start" class="mt-3">
        <input type="hidden" name="user_id" value="{{ author.id }}"/>
        <button class="bg-purple-600 text-white px-3 py-1 rounded">Message</button>
      </form>
      {% endif %}
    </div>

    <!-- Comments -->
    <h3 class="font-semibold mb-2">Comments</h3>
    <div class="space-y-2 mb-3">
      {% for c in comments %}
        <div class="border rounded p-2">
          <div class="text-sm text-gray-500">{{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
          <div>{{ c.content }}</div>
        </div>
      {% else %}
        <p class="text-gray-500">No comments yet.</p>
      {% endfor %}
    </div>

    {% if user %}
      <form method="post" action="/posts/{{ post.id }}/comment" class="flex gap-2">
        <input name="content" class="border p-2 flex-1" placeholder="Add a comment…" required>
        <button class="bg-gray-800 text-white px-3 rounded">Send</button>
      </form>
    {% else %}
      <a href="/login" class="text-blue-600 underline">Log in</a> to comment.
    {% endif %}
  </div>
</div>
{% endblock %}